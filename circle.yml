#machine:
#  pre:
#    - sudo docker -d -e lxc -s btrfs -H tcp://0.0.0.0:2375:
#        background: true
#    - curl --retry 15 --retry-delay 3 -v http://172.17.42.1:2375/version
#  environment:
#    REPO: $CIRCLE_PROJECT_USERNAME/$CIRCLE_PROJECT_REPONAME
#    DOCKER_HOST: tcp://172.17.42.1:2375
#    MAKE_DOCKER_HOST: $DOCKER_HOST
#    VERSION: v1.0.alpha.$CIRCLE_BUILD_NUM
machine:
  pre:
    - sudo service docker stop
    - sudo curl https://get.docker.com/builds/Linux/x86_64/docker-1.10.1 -o /usr/bin/docker
    - sudo chmod +x /usr/bin/docker
    - sudo service docker start
#  services:
#    - docker

dependencies:
  pre:
    - docker version
    - pip install --user mkdocs
    - pip install --user pymdown-extensions
#    - go get github.com/tcnksm/ghr
    - make validate
  override:
    - make binary

test:
  override:
    - make test-unit
    - make test-integration
  post:
    - make binary
    - make image

#deployment:
#  hub:
#    branch: master
#    commands:
#      - ghr -t $GITHUB_TOKEN -u $CIRCLE_PROJECT_USERNAME -r $CIRCLE_PROJECT_REPONAME --prerelease ${VERSION} dist/
#      - docker login -e $DOCKER_EMAIL -u $DOCKER_USER -p $DOCKER_PASS
#      - docker push ${REPO,,}:latest
#      - docker tag ${REPO,,}:latest ${REPO,,}:${VERSION}
#      - docker push ${REPO,,}:${VERSION}
